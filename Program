#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#define size 2

int hash[size];
int i;
int pin1 = 123456;
int pin2 = 654321;  
struct Database {
    int b;
    int c;
    char pin1[size];
    int pin;
    int d;
   char nomer[size];
   char score[50];
} data[50], curr;



void init()
{   
    int i;
    for(i = 0; i < size; i++)
        hash[i] = -1;
}

void insert(int value)
{   
    int key = value % size;
    
    if(hash[key] == -1)
    {   
        hash[key] = value;
        printf("\n");
    }
    else
    {   
        printf("Collision : hash[%d] has element %d already!\n",key,hash[key]);
        printf("Unable to insert %d\n",value);
    }
}

void print()
{
    int i;
    for(i = 0; i < size; i++)
        printf("hash[%d] = %d\n",i,hash[i]);
}

void search(int value)
{
    int key = value % size;
    if(hash[key] == value) {
        printf("Nomor terverifikasi\n");
    }
    else {
        printf("Nomor anda tidak terdata\n");
        return main();
    }
}

int inspin()
{
    printf("Masukkan Pin Anda : ");
 scanf("%d",&data->pin);
 printf("======= ============================\n");
 if(data->pin == pin1){
     data->c = 1;
 }
 else if(data->pin == pin2){
     data->d = 1;
 }
}

int main ()
{
    FILE *fp;
    fp = fopen("pin.txt","r");
    while(!feof(fp)){
        fscanf(fp,"%s %s",data[i].nomer,data[i].pin1);
        i++;
    }
    int a;
    init();
    insert(5412);
    insert(4265);
    int pilihan,pil2, npin1,npin2, nominal2;
    char konfirmasi[5];
    int salah = 0;
 printf("===================================\n");

 printf("\tSelamat datang di ATM \n");

 printf("===================================\n");
 printf("Masukan nomor kartu anda : ");
    scanf("%d",&a);
    search(a);
inspin();
if(hash[0] == 5412 && data->c==1){
     printf("Pin benar\n");
     
 }
 else if(hash[1] == 4265 && data->d == 1){
     printf("Pin benar\n");
     
 }
 else{
     printf("Pin salah\n");
     return main();
 }

if(size == 2)
{
        awal:

        printf("1. Cek Saldo\n");

        printf("2. Deposit\n");

        printf("3. Withdraw\n");

        printf("4. Transfer\n");

        printf("5. Lihat Riwayat Transaksi\n");

        printf("6. Ganti PIN\n");

        printf("7. EXIT\n");

        printf("Masukkan Pilihan anda (1-7) : ");

        scanf("%d",&pilihan);

        switch(pilihan){

            case 1:
                system("cls");

                printf("Cek Saldo \n");
                break;

            case 2:
                system("cls");
                break;

            case 3 :
                system("cls");
                printf("=============Withdraw============\n");
                printf("#Rp.100.000");
                printf("\t\t#Rp.200.000\n");
                printf("#Rp.500.000");
                printf("\t\t#Rp.1000.000\n");
                printf("#Nominal lainnya");

                break;

            case 4 :
                system("cls");
                printf ("masukkan pin: ");
                scanf("%d",&data->pin);
                if (data->pin==pin1){
                    printf("hay");
                }else{
                    printf("PIN salah");
                }
                break;

            case 5 :
                system("cls");

                break;

            case 6 :
                system("cls");
                printf("==========GANTI PIN ==========\n");
                pinlama:
                printf("Masukan PIN lama:"); scanf("%d", &data->pin);
                if(data->pin==pin1){
                goto pinbaru1;
                }
                else if (data->pin==pin2){
                goto pinbaru2;
                }
                else {
                printf("PIN ANDA SALAH!\n");
                salah++;
                 if(salah==3){
                    printf("===akses ditolak===");
                    goto konfirmasi;
                 }else {
                 goto pinlama;
                 }
                }

                pinbaru1:
                printf("Masukan PIN baru:"); scanf("%d", &npin1);
                printf("apakah anda yakin ingin mengganti pin? \n\t1.Iya\n\t2.Tidak\nmasukkan pilihan :");
                scanf("%d", &pil2);
                if (pil2==1){
                pin1=npin1;
                printf("\n===PIN berhasil diubah===");
                printf("\nPIN saat ini %d", npin1);
                }else if (pil2==2){
                printf("===Penggantian pin dibatalkan==");
                }
                else {
                printf("inputan salah");
                }
                goto konfirmasi;
                pinbaru2:
                printf("Masukan PIN baru:"); scanf("%d", &npin2);
                printf("apakah anda yakin ingin mengganti pin? \n\t1.Iya\n\t2.Tidak\nmasukkan pilihan :");
                scanf("%d", &pil2);
                if (pil2==1){
                pin2=npin2;
                printf("\n===PIN berhasil diubah===");
                printf("\nPIN saat ini %d", npin2);
                }else if (pil2==2){
                printf("===Penggantian pin dibatalkan==");
                }
                else {
                printf("inputan salah");
                }
                goto konfirmasi;
                break;

            case 7 :

                goto akhir;

                break;

                default : printf("Pilihan anda salah");

        }

         konfirmasi:

         printf("\nApakah anda ingin bertransaksi kembali ? Y/T : ");

         scanf("%s",&konfirmasi);

         if(strcmp(konfirmasi, "Y") == 0 || strcmp(konfirmasi, "y") == 0){

                goto awal;

         }else if(strcmp(konfirmasi, "T") == 0 || strcmp(konfirmasi, "t") == 0){

                goto akhir;
                akhir:
                system("cls");
                printf("================================");
                printf("\nTerimakasih sudah bertransaksi");
                printf("\n================================\n");

         }else{

            printf("\nPilihan salah");

            goto konfirmasi;

         }

    }else{

        printf("\nPIN yang anda masukkan salah");

    }
   return 0;

}
