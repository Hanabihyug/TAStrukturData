#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#define size 2

int hash[size];
int i,hasil=-1;
int key,z,e,f,g,h,depo;
struct Database {
    int b;
    int c;
    int pin1;
    int pin;
    int temp;
    int temp1;
    int d;
    int saldo;
   long long nomer;
   char score[size];
} data[50], curr;  

void gantipin()
{
    int a;
    puts("========== GANTI PIN ==========");
    printf("Masukan PIN lama anda : ");
    scanf("%d",&a);
    if(a==data[z].pin1){
        puts("PIN benar");
    }
    else {
        puts("PIN salah");
        return gantipin();
    }
    pinbaru();
    
    
}

void pinbaru()
{
    printf("Masukan PIN baru anda : ");
    scanf("%d",&data->temp);
    printf("Konfirmasi PIN baru anda : ");
    scanf("%d",&data->temp1);
    if(data->temp == data->temp1){
        puts("PIN Baru terkonfirmasi");
        data[z].pin1 = data->temp;
    }
    else {
        puts("PIN baru salah");
        return gantipin();
    }
    puts("PIN telah terganti");
}

void ngirim()
{
    int a;
    printf("Masukan Nomor bank tujuan anda : ");
    scanf("%d",&a);
    search1(a);
}

void transfer()
{
    int y;
    puts("Transfer : ");
    puts("1. Rp.100.000");
    puts("2. Rp.200.000");
    puts("3. Rp.500.000");
    puts("4. Rp.1.000.000");
    puts("5.Nominal lainnya");
    printf("Masukan pilihan anda : ");
    scanf("%d",&y);
    switch(y) {
        case 1:
        data[z].saldo = data[z].saldo-100000;
        break;
        case 2:
        data[z].saldo = data[z].saldo-200000;
        break;
        case 3:
        data[z].saldo = data[z].saldo-500000;
        break;
        case 4:
        data[z].saldo = data[z].saldo-1000000;
        break;
        default : 
        puts("Pilihan salah");
        return transfer();
    }
    ngirim();
    inspin();
    puts("Transfer berhasil");  
}

void withdraw()
{
                puts("=============Withdraw============");
                puts("1. Rp.100.000");
                puts("2. Rp.200.000");
                puts("3. Rp.500.000");
                puts("4. Rp.1.000.000");
                puts("5.Nominal lainnya");
                printf("Masukan pilihan anda : ");
                scanf("%d",&g);
                switch(g) {
                    case 1:
                    if(data[z].saldo<100000){
                        printf("Saldo anda tidak mencukupi");
                        return withdraw();
                    }
                    data[z].saldo = data[z].saldo - 100000;
                    break;
                    case 2:
                    if(data[z].saldo<200000){
                        printf("Saldo anda tidak mencukupi");
                        return withdraw();
                    }
                    data[z].saldo = data[z].saldo - 200000;
                    break;
                    case 3:
                    if(data[z].saldo<500000){
                        printf("Saldo anda tidak mencukupi");
                        return withdraw();
                    }
                    data[z].saldo = data[z].saldo - 500000;
                    break;
                    case 4:
                    if(data[z].saldo<1000000){
                        puts("Saldo anda tidak mencukupi");
                        return withdraw();
                    }
                    data[z].saldo = data[z].saldo - 1000000;
                    break;
                    case 5:
                    printf("Masukan nominal : ");
                    scanf("%d",h);
                    data[z].saldo = data[z].saldo - h;
                    default:
                    puts("Pilihan salah");
                    return withdraw();
                }  
                inspin();
                puts("Transaksi berhasil");
                puts("Jumlah saldo anda saat ini : ");
                printf("Rp. %d",data[z].saldo);
}

void deposit()
{
    puts("Pilih jumlah pecahan uang : ");
    puts("1.Rp. 20.000");
    puts("2. Rp. 50.000");
    puts("3. Rp. 75.000");
    puts("4. Rp. 100.000");
    printf("Masukan pilihan anda (1-4): ");
    scanf("%d",&e);
    printf("Masukan jumlah lembar : ");
    scanf("%d",&f);
    switch(e) {
    
    case 1:
        system("cls");
        depo = 20000*f;
        break;
    
    case 2:
        system("cls");
        depo = 50000*f;
        break;
        
    case 3:
        system("cls");
        depo = 75000*f;
        break;
    case 4:
    system("cls");
    depo = 100000*f;
    default :
        puts("Pilihan salah");
        return deposit();
    }
    data[z].saldo = data[z].saldo+depo;
    inspin();
    puts("Transaksi berhasil");
    puts("Jumla saldo anda saat ini : ");
    printf("Rp. %d",data[z].saldo);
}

void ceksaldo()
{
    puts("Jumlah saldo anda : ");
    printf("Rp. %d\n",data[z].saldo);
}


void init()
{
    int i;
    for(i = 0; i < size; i++)
        hash[i] = -1;
}

void insert(int value)
{
    int key = value % size;

    if(hash[key] == -1)
    {
        hash[key] = value;
        printf("\n");
    }
    else
    {
        printf("Collision : hash[%d] has element %d already!\n",key,hash[key]);
        printf("Unable to insert %d\n",value);
    }
}

void search1(int value)
{
     key = value % size;
    if(hash[key] == value) {
        printf("Nomor terverifikasi\n");
    }
    else {
        printf("Nomor anda tidak terdata\n");
        return ngirim();
    }
}

void search(int value)
{
     key = value % size;
    if(hash[key] == value) {
        printf("Nomor terverifikasi\n");
        z = key;
    }
    else {
        printf("Nomor anda tidak terdata\n");
        return main();
    }
}

int inspin()
{
    printf("Masukkan Pin Anda : ");
 scanf("%d",&data->pin);
 printf("====================================\n");
 
 if(hash[z]==data[z].nomer && data->pin==data[z].pin1){
     printf("PIN benar\n");
 }
 else {
     printf("PIN salah\n");
     return inspin();
}
}
int main ()
{
    int pin1,pin2,a;
    FILE *fp,*fd;
    fp = fopen("pin.txt","r");
    while(!feof(fp)){
        fscanf(fp,"%lld %d %d",&data[i].nomer,&data[i].pin1,&data[i].saldo);
        i++;
    }
    fclose(fp);
    init();
    for(i=0;i<size;i++){
     insert(data[i].nomer);   
    }
    int pilihan,pil2, npin1,npin2, nominal2;
    char konfirmasi[5];
    int salah = 0;
 printf("===================================\n");
 printf("\tSelamat datang di ATM \n");
 printf("===================================\n");
 printf("Masukan nomor kartu anda : ");
    scanf("%d",&a);
    search(a);
inspin();
  

if(size == 2)
{
        awal:

        printf("1. Cek Saldo\n");

        printf("2. Deposit\n");

        printf("3. Withdraw\n");

        printf("4. Transfer\n");

        printf("5. Lihat Riwayat Transaksi\n");

        printf("6. Ganti PIN\n");

        printf("7. EXIT\n");

        printf("Masukkan Pilihan anda (1-7) : ");

        scanf("%d",&pilihan);

        switch(pilihan){

            case 1:
                system("cls");
                ceksaldo();
                break;

            case 2:
                system("cls");
                deposit();
                break;

            case 3 :
                system("cls");
                withdraw();
                break;

            case 4 :
                system("cls");
                transfer();
                break;

            case 5 :
                system("cls");

                break;

            case 6 :
                system("cls");
                gantipin();
                break;

            case 7 :

                goto akhir;

                break;

                default : printf("Pilihan anda salah");

        }

         konfirmasi:

         printf("\nApakah anda ingin bertransaksi kembali ? Y/T : ");

         scanf("%s",&konfirmasi);

         if(strcmp(konfirmasi, "Y") == 0 || strcmp(konfirmasi, "y") == 0){

                goto awal;

         }else if(strcmp(konfirmasi, "T") == 0 || strcmp(konfirmasi, "t") == 0){

                goto akhir;
                akhir:
                system("cls");
                printf("================================");
                printf("\nTerimakasih sudah bertransaksi");
                printf("\n================================\n");

         }else{
            printf("\nPilihan salah");
            goto konfirmasi;
         }

    }else{

        printf("\nPIN yang anda masukkan salah");

    }
    FILE *fw;
    fw = fopen("pin1.txt","w");
    for(i=0;i<size;i++){
        fprintf(fw,"%lld %d %d\n",data[i].nomer,data[i].pin1,data[i].saldo);
    }
    fclose(fw);
    remove("pin.txt");
    rename("pin1.txt","pin.txt");
   return 0;

}
